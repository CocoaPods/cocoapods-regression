#!/usr/bin/env ruby

require 'bundler/setup'
require 'regression'
require 'yaml'

if ARGV[0].nil?
  puts 'Available regression tests:'

  Dir.foreach('apps') do |file|
    next unless file.end_with?('.yaml')
    puts "\t#{File.basename(file, '.yaml')}"
  end

  exit(0)
end

app_config_path = "apps/#{ARGV[0]}.yaml"

unless File.exist?(app_config_path)
  $stderr.puts "Regression test `#{ARGV[0]}` does not exist."
  exit(1)
end

app = YAML.load(File.new(app_config_path))
checkout = CocoaPods::Regression.clone(app['source'], ARGV[0])
xcode = CocoaPods::Regression::Xcode.new(app)

builder = CocoaPods::Regression::Builder.new(app)
builder.working_directory = checkout
builder.build(xcode)
